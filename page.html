<!DOCTYPE html>
<html>

<head>
	
	<title>Featured Game</title>

  <style type="text/css">

    body {
      font-family: Helvetica;
      --bgColor: #fff;
      --accent: #6441A4;
      --fontColor: #232127;
    }

    .darkMode {
      --bgColor: #201c2b;
      --accent: #6441A4;
      --fontColor: #e5e3e8;
    }

    button {
      height: 1.5rem;
      width: 2rem;
      margin-top: .1rem;
      font-size: 0.9rem;
    }

    a.button {
      appearance: button;
      text-decoration: none;
      color: initial;
    }

    .players {
      color: #26211b;
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: .2rem;
    }

    .vs {
      color: #5a5855;
      font-weight: 400;
    }

    .info {
      color: #5a5855;
      font-size: 0.9rem;
    }

    .moves {
      width: 288px;
      background-color: #fff;
      border: .1rem solid #e8e7e6;
    }

  </style>

  <!-- chess.js package -->
  <script src="node_modules/chess.js/chess.js"></script>

  <!-- chessboard.js package -->
  <link rel="stylesheet" type="text/css" href="node_modules/@chrisoakman/chessboardjs/dist/chessboard-1.0.0.min.css">
  <script src="node_modules/jquery/dist/jquery.js"></script>
  <script src="node_modules/@chrisoakman/chessboardjs/dist/chessboard-1.0.0.js"></script>

  <!-- stockfish.js package -->
  <script src="node_modules/stockfish/src/stockfish.js"></script>
  <script src="engine.js"></script>

  <!-- <script type="text/javascript">
    const chess = new Chess();
    var xh = new XMLHttpRequest();
    var fens = [];
    
    xh.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {

        // fetch and parse game data to update the display
        var archive = JSON.parse(this.responseText);
        var game = archive.games[archive.games.length-1];
        document.getElementById("players").innerHTML = game.white.username + " (" + game.white.rating + ")" + "<span class='vs'> vs. </span>" + game.black.username + " (" + game.black.rating + ")";
        document.getElementById("link").href = game.url;
        var pgn = game.pgn;

        // extract move list
        var start = pgn.search("Link");
        var moves = pgn.slice(pgn.indexOf("1.",start),pgn.length);
        if (moves.indexOf("{") != -1) {
          var temp = moves.split(" ");
          var new_moves = temp.filter(filtering);
          if (new_moves[new_moves.length-1] != temp[temp.length-1]) {
            new_moves.push(temp[temp.length-1])
          }
          moves = new_moves.join(" ");
        }

        // build moves HTML
        var splitMoves = moves.split(" ");
        var movesHTML = splitMoves[0];
        var idx = 0;
        for (i = 1; i < splitMoves.length; i++) {
          if (i % 3 == 0 || i == splitMoves.length-1) {
            movesHTML += " " + splitMoves[i];
          } else {
            movesHTML += " <span id='" + idx + "' onclick='goToMove(" + idx + ")'>" + splitMoves[i] + "</span>";
            idx++;
          }
        }
        document.getElementById("moves").innerHTML = movesHTML;

        // extract game info
        var result = moves.slice(moves.lastIndexOf(" ")+1) + " | ";
        var start = pgn.indexOf("Event");
        var end = pgn.search("]",start);
        var event = pgn.slice(start+7, end-1) + " | Chess.com | ";
        var start = pgn.indexOf("Date");
        var end = pgn.indexOf("]",start);
        var date = pgn.slice(start+6, end-1);
        document.getElementById("info").innerHTML = result + event + date;

        // cleaning up chess.com PGNs
        function filtering(value, index, array) {
          switch (index % 8) {
            case 0:
              return true;
              break;
            case 1:
              return true;
              break;
            case 5:
              return true;
              break;
          }
        }

        // get moves as a list of fens
        chess.load_pgn(game.pgn);
        var hist = chess.history();
        var chess2 = new Chess();
        for (var i=0; i < hist.length; i++) {
          chess2.move(hist[i]);
          fens.push(chess2.fen());
        }
      }
    };

    // get the current month
    var d = new Date();
    var month = d.getMonth() + 1;
    if (month < 10) {
      month = "0" + month;
    }

    function update() {
      // fetch the game archive and update the display
      xh.open("GET", "https://api.chess.com/pub/player/ChemStud24/games/" + d.getFullYear() + "/" + month, true);
      xh.send();
    }

    update();
    setInterval(update,30000);

  </script> -->

</head>	

<body>
<!--   <div id="app" class="full-height"></div>
        <script src="https://extension-files.twitch.tv/helper/v1/twitch-ext.min.js"></script>
      <script src="https://localhost.rig.twitch.tv:3000/twitch-ext.js"></script> -->

  <div style="width: 288px">
    <div id="header" style="background: #f3f3f3; width: 288px; border-bottom: 6px solid #f3f3f3">
        <div id="players" class="players"></div>
        <div id="info" class="info"></div>

      <div id="myBoard" style="width: 288px; text-align: center;"></div>
      <!-- <script type="text/javascript">
        var moveIdx = -1;
        var playing = false;
        var playId;
        var board = Chessboard("myBoard","start");

        function goToStart() {
          // un-highlight the last position
          if (moveIdx != -1) {
            document.getElementById(moveIdx).style="background-color: #fff";
          }

          if (playing) {
            playpause();
          }
          moveIdx = -1;
          board.position("start");
        }

        function nextMoveButton() {
          if (playing) {
            playpause();
          }
          nextMove();
        }

        function nextMove() {
          // un-highlight the last position
          if (moveIdx != -1) {
            document.getElementById(moveIdx).style="background-color: #fff";
          }

          moveIdx++;
          if (moveIdx > fens.length-1) {
            moveIdx = fens.length-1;
            if (playing) {
              playpause();
            }
          }

          // highlight the current position
          document.getElementById(moveIdx).style="background-color: #ffff00";

          board.position(fens[moveIdx]);
        }

        function prevMove() {
          // un-highlight the last position
          if (moveIdx != -1) {
            document.getElementById(moveIdx).style="background-color: #fff";
          }

          if (playing) {
            playpause();
          }
          moveIdx--;
          if (moveIdx <= -1) {
            moveIdx = -1;
            board.position("start");
          } else {
            // highlight the current position
            document.getElementById(moveIdx).style="background-color: #ffff00";
            board.position(fens[moveIdx]);
          }
        }

        function goToMove(n) {
          // un-highlight the last position
          if (moveIdx != -1) {
            document.getElementById(moveIdx).style="background-color: #fff";
          }

          moveIdx = n;
          if (playing) {
            playpause();
          }

          // highlight the current position
          document.getElementById(n).style="background-color: #ffff00";
          board.position(fens[n]);
        }

        function goToEnd() {
          // un-highlight the last position
          if (moveIdx != -1) {
            document.getElementById(moveIdx).style="background-color: #fff";
          }

          if (playing) {
            playpause();
          }
          moveIdx = fens.length-1

          // highlight the current position
          document.getElementById(moveIdx).style="background-color: #ffff00";
          board.position(fens[moveIdx]);
        }

        function playpause() {
          if (playing) {
            document.getElementById("play-pause").innerHTML = "&#9658";
            clearInterval(playId);
          } else {
            document.getElementById("play-pause").innerHTML = "&#10074&#10074";
            nextMove();
            playId = setInterval(nextMove,1000);
          }
          playing = !playing;
        }
      </script> -->

      <!-- <script type="text/javascript">
        var board = Chessboard("myBoard","start");
      </script> -->

      <div>
        <a id="link" target="_blank" class="button">&#128279</a>
        <span style="float: right;">
          <button id="flipBtn">&#8625&#8626</button>
          <!-- onclick="board.orientation('flip');" -->
          <button id ="play-pause" style="font-size: 0.6rem;">&#9658</button>
          <!-- onclick="playpause()" -->
          <button id="startBtn">|<</button>
          <!-- onclick="goToStart()" -->
          <button id="prevBtn"><<</button>
          <!-- onclick="prevMove()" -->
          <button id="nextBtn">>></button>
          <!-- onclick="nextMoveButton()" -->
          <button id="endBtn">>|</button>
          <!-- onclick="goToEnd()" -->
        </span>
      </div>  
    </div>
      <!-- <button>&#9875</button> -->
      <!-- <button>&#9208</button> -->
      <!-- <button>&#9198</button> -->
      <!-- <button>&#8810</button> -->
      <!-- <button>&#8811</button> -->
      <!-- <button>&#9197</button> -->
      <!-- &#9812 through &#9823 are chess pieces -->

    <div id="moves" class="moves"></div>
    <p id="evals"></p>
  </div>

  <!-- <script type="text/javascript">
    document.getElementById("test").innerHTML = temp.fen();
  </script> -->

  <!-- js I wrote for this app -->
  <script src="featured-game.js"></script>

</body>

</html>